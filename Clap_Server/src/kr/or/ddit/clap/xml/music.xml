<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
         PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
         "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<!-- namespace속성 : 아래에서 작성한 SQL을 호출할 때 같이 사용된다. -->

<sqlMap namespace="music">

	<select id="selectListAll" resultClass="musicVO">
		
	    select a.ALB_IMAGE,
           b.MUS_TITLE,
           a.ALB_NAME,
           c.SING_NAME,
           d.GEN_DETAIL_NAME,
           b.MUS_NO
      from album a, music b, singer c, GENRE_DETAIL d
     where a.alb_no = b.alb_no
       and a.sing_no = c.sing_no
       and b.gen_detail_no = d.gen_detail_no

	</select>
	
	<!-- 검색용 쿼리 -->
	<select id="searchList" resultClass="musicVO"
		parameterClass="musicVO">

	    select a.ALB_IMAGE,
           b.MUS_TITLE,
           a.ALB_NAME,
           c.SING_NAME,
           d.GEN_DETAIL_NAME,
           b.MUS_NO
      from album a, music b, singer c, GENRE_DETAIL d
     where a.alb_no = b.alb_no
       and a.sing_no = c.sing_no
       and b.gen_detail_no = d.gen_detail_no
		<isNotEmpty property="mus_title" prepend="and">
			b.mus_title like '%' || #mus_title# || '%'
		</isNotEmpty>
		<isNotEmpty property="alb_name" prepend="and">
			a.alb_name like '%' || #alb_name# || '%'
		</isNotEmpty>
		<isNotEmpty property="sing_name" prepend="and">
			c.sing_name like '%' || #sing_name# || '%'
		</isNotEmpty>
	</select>
	 
	 
	 <select id="showGenre" resultClass="GenreVO">
		select gen_no,
       		gen_name
  			from genre
	</select>
	
	<!-- 콤보박스에서 받은 장르 값으로 장르번호를 리턴 -->
	 <select id="selectGenreNO" resultClass="String"  parameterClass="String">
		select gen_no
  			from genre
  		where gen_name = #String# 
	</select>
	
	
	 <select id="showGenreDetail" resultClass="GenreDetailVO"  parameterClass="String">
		select GEN_DETAIL_NO,
			   GEN_DETAIL_NAME
  			from GENRE_DETAIL
  		where GEN_NO = #String# 
	</select>
	
	 <select id="selectGenreDetailNO" resultClass="String"  parameterClass="String">
		select GEN_DETAIL_NO
  			from GENRE_DETAIL
  		where GEN_DETAIL_NAME = #String# 
	</select>
	
	
	<insert id="insertMusic" parameterClass="MusicVO">
			insert into MUSIC(
						MUS_NO,
						MUS_TITLE,
						MUS_TIME,
						MUS_FILE,
						MUS_MUSWRITE_SON,
						MUS_EDIT_SON,
						MUS_WRITE_SON,
						MUS_LYRICS,
						ALB_NO,
						GEN_DETAIL_NO
			)
			values(			
						seq_mus_no.nextval,
						#mus_title#,
						#mus_time#,
						#mus_file#,
						#mus_muswrite_son#,
						#mus_edit_son#,
						#mus_write_son#,
						#mus_lyrics#,
						#alb_no#,
						#gen_detail_no#
			)
			
	</insert>
	
  <!-- 곡 상세보기 클릭 정보를 조회하는 쿼리 -->
  <select id="selectMusicDetailInfo" resultClass="musicVO" parameterClass="String">
	    select 
	       a.ALB_IMAGE,
           b.MUS_TITLE,
           a.ALB_NAME,
           c.SING_NAME,
           d.GEN_DETAIL_NAME,
           b.MUS_MUSWRITE_SON,
           b.MUS_EDIT_SON,
           b.MUS_WRITE_SON,
           b.MUS_LYRICS,
           e.gen_name,
           a.alb_no,
           d.gen_Detail_no,
           b.mus_time,
           b.MUS_FILE
      from album a, music b, singer c, GENRE_DETAIL d, GENRE e
     where a.alb_no = b.alb_no
       and a.sing_no = c.sing_no
       and b.gen_detail_no = d.gen_detail_no
       and d.gen_no = e.gen_no
       and b.mus_no=#String#

	</select>
  
  <!-- 곡에 대한 좋아요 수 개수를 구하는 쿼리 -->
	<select id="selectMusicLikeCnt" resultClass="int" parameterClass="String">
		  select count(MUS_NO)
		from MUSIC_LIKE
		where MUS_NO =#String#
	</select>
  
  <!--  곡 정보를 삭제하는 쿼리 -->
 <delete id="deleteMusic" parameterClass="String">
			delete from music where MUS_NO=#String#
	 </delete>
  
</sqlMap>         




